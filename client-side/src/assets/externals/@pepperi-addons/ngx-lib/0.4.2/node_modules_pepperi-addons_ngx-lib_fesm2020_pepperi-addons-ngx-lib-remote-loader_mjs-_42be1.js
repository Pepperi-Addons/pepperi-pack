(self.webpackChunkblock=self.webpackChunkblock||[]).push([["node_modules_pepperi-addons_ngx-lib_fesm2020_pepperi-addons-ngx-lib-remote-loader_mjs-_42be1"],{45209:(te,B,y)=>{y.d(B,{Ux:()=>s,_8:()=>$,iz:()=>Z});var E=y(60562),x=y(62923),j=y(66231),P=y(40455);let $=(()=>{class c{}return c.\u0275fac=function(m){return new(m||c)},c.\u0275mod=E.\u0275\u0275defineNgModule({type:c}),c.\u0275inj=E.\u0275\u0275defineInjector({imports:[[x.CommonModule]]}),c})();const I="@angular-architects/module-federation-tools";function N(){const c=window;return c[I]=c[I]||{},c[I]}function A(c){const a=N();return c?c(a):a}function V(c){return Object.assign(N(),c)}function Z(c,a=!1){let m;a?(m=`${location.hash.substr(1)}${location.search}`,c.navigateByUrl(m),window.addEventListener("hashchange",()=>{c.navigateByUrl(m)})):(m=`${location.pathname.substr(1)}${location.search}`,c.navigateByUrl(m),window.addEventListener("popstate",()=>{c.navigateByUrl(m)}))}let H=!0,U=!0,L=!0;function Q(){const c=window;return c.platform=c.platform||{},c}function t(){return A(c=>c.platformCache)||V({platformCache:new Map}).platformCache}function l(c){if(!U)return c.platformFactory();const a=c.version(),m=a===E.VERSION.full?E.VERSION:a,b="string"==typeof m?m:m.full;let v=t().get(m)||L&&function z(c){const a=Q().platform[c];return a instanceof E.PlatformRef?a:null}(b);return v||(v=c.platformFactory(),function o(c,a){U&&(L&&function J(c,a){Q().platform[c]=a}(c.full,a),t().set(c,a))}(E.VERSION,v),c.production&&(0,E.enableProdMode)()),v}function s(c,a){var m;return H=!1!==a.ngZoneSharing,U=!1!==a.platformSharing,L=!1!==a.activeLegacyMode,a.platformFactory=a.platformFactory||(()=>(0,P.platformBrowser)()),a.version=a.version||(()=>E.VERSION),H&&!(null!==(m=a.compilerOptions)&&void 0!==m&&m.ngZone)&&(a.compilerOptions=a.compilerOptions||{},a.compilerOptions.ngZone=function i(){return A(c=>c.ngZone)||function X(){return window.ngZone}()}()),l(a).bootstrapModule(c,a.compilerOptions).then(b=>("shell"===a.appType?function h(c){const a=c.get(E.NgZone,null);a?function d(c){H&&(L&&function Y(c){window.ngZone=c}(c),V({ngZone:c}))}(a):console.warn("No NgZone to share found")}(b.injector):"microfrontend"===a.appType&&function _(c){const a=c.get(j.Router);a?Z(a):console.warn("No router to connect found")}(b.injector),b))}},70655:(te,B,y)=>{function j(t,o,l,i){var h,d=arguments.length,s=d<3?o:null===i?i=Object.getOwnPropertyDescriptor(o,l):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,o,l,i);else for(var _=t.length-1;_>=0;_--)(h=t[_])&&(s=(d<3?h(s):d>3?h(o,l,s):h(o,l))||s);return d>3&&s&&Object.defineProperty(o,l,s),s}function D(t,o){return function(l,i){o(l,i,t)}}function R(t,o,l,i){return new(l||(l=Promise))(function(s,h){function _(m){try{a(i.next(m))}catch(b){h(b)}}function c(m){try{a(i.throw(m))}catch(b){h(b)}}function a(m){m.done?s(m.value):function d(s){return s instanceof l?s:new l(function(h){h(s)})}(m.value).then(_,c)}a((i=i.apply(t,o||[])).next())})}function O(t){return this instanceof O?(this.v=t,this):new O(t)}function Z(t,o,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var d,i=l.apply(t,o||[]),s=[];return d={},h("next"),h("throw"),h("return"),d[Symbol.asyncIterator]=function(){return this},d;function h(v){i[v]&&(d[v]=function(M){return new Promise(function(F,q){s.push([v,M,F,q])>1||_(v,M)})})}function _(v,M){try{!function c(v){v.value instanceof O?Promise.resolve(v.value.v).then(a,m):b(s[0][2],v)}(i[v](M))}catch(F){b(s[0][3],F)}}function a(v){_("next",v)}function m(v){_("throw",v)}function b(v,M){v(M),s.shift(),s.length&&_(s[0][0],s[0][1])}}function U(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l,o=t[Symbol.asyncIterator];return o?o.call(t):(t=function I(t){var o="function"==typeof Symbol&&Symbol.iterator,l=o&&t[o],i=0;if(l)return l.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(o?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),l={},i("next"),i("throw"),i("return"),l[Symbol.asyncIterator]=function(){return this},l);function i(s){l[s]=t[s]&&function(h){return new Promise(function(_,c){!function d(s,h,_,c){Promise.resolve(c).then(function(a){s({value:a,done:_})},h)}(_,c,(h=t[s](h)).done,h.value)})}}}y.d(B,{FC:()=>Z,KL:()=>U,fM:()=>D,gn:()=>j,mG:()=>R,qq:()=>O})},44267:(te,B,y)=>{y.r(B),y.d(B,{PepAddonBlockLoaderComponent:()=>F,PepAddonBlockLoaderService:()=>q,PepRemoteLoaderComponent:()=>v,PepRemoteLoaderElementComponent:()=>M,PepRemoteLoaderModule:()=>ne,PepRemoteLoaderService:()=>b});var E=y(15861),r=y(60562),x=y(20925),S=y(11688),j=y(62923),D=y(6519),P=y(70655);let R={};const T={},k={};let $=!1;function N(n,f){return(0,P.mG)(this,void 0,void 0,function*(){return k[f]||($||(yield y.I("default"),$=!0),yield n.init(y.S.default),k[f]=!0),n})}function K(n,f){return(0,P.mG)(this,void 0,void 0,function*(){return new Promise((e,u)=>{if(T[f])return void e();const p=document.createElement("script");p.src=n,p.onerror=u,p.onload=()=>{const g=window[f];N(g,f),T[f]=g,e()},document.body.appendChild(p)})})}function O(n){return(0,P.mG)(this,void 0,void 0,function*(){let f,e,u;if(n.type||(n.type="script"),"manifest"===n.type){const p=R[n.remoteName];if(!p)throw new Error("Manifest does not contain "+n.remoteName);n={type:p.type,exposedModule:n.exposedModule,remoteEntry:p.remoteEntry,remoteName:"script"===p.type?n.remoteName:void 0},u=p.remoteEntry}else u=n.remoteEntry;return"script"===n.type?(f={type:"script",remoteEntry:n.remoteEntry,remoteName:n.remoteName},e=n.remoteName):"module"===n.type&&(f={type:"module",remoteEntry:n.remoteEntry},e=n.remoteEntry),u&&(yield function A(n,f){return(0,P.mG)(this,void 0,void 0,function*(){if("string"==typeof n)return yield K(n,f);if("script"===n.type){const e=n;return yield K(e.remoteEntry,e.remoteName)}"module"===n.type&&(yield function V(n){return(0,P.mG)(this,void 0,void 0,function*(){return T[n]?Promise.resolve():yield import(n).then(f=>{N(f,n),T[n]=f})})}(n.remoteEntry))})}(f)),yield function I(n,f){return(0,P.mG)(this,void 0,void 0,function*(){return(yield T[n].get(f))()})}(e,n.exposedModule)})}var Q=y(66231),z=y(72851),J=y(81638),X=y(45209);const Y=["placeHolder"];function t(n,f){}const o=["dialogTemplate"];function l(n,f){1&n&&r.\u0275\u0275elementContainer(0)}function i(n,f){if(1&n&&(r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275template(1,l,1,0,"ng-container",3),r.\u0275\u0275elementContainerEnd()),2&n){r.\u0275\u0275nextContext();const e=r.\u0275\u0275reference(4);r.\u0275\u0275advance(1),r.\u0275\u0275property("ngTemplateOutlet",e)}}function d(n,f){1&n&&r.\u0275\u0275elementContainer(0)}function s(n,f){if(1&n){const e=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementStart(0,"pep-dialog",4),r.\u0275\u0275listener("close",function(p){r.\u0275\u0275restoreView(e);const g=r.\u0275\u0275nextContext();return r.\u0275\u0275resetView(g.closeDialog(p))}),r.\u0275\u0275elementContainerStart(1,5),r.\u0275\u0275template(2,d,1,0,"ng-container",3),r.\u0275\u0275elementContainerEnd(),r.\u0275\u0275elementEnd()}if(2&n){const e=f.$implicit;r.\u0275\u0275nextContext();const u=r.\u0275\u0275reference(4);r.\u0275\u0275property("showClose",null==e?null:e.showClose)("showHeader",null==e?null:e.showHeader)("showFooter",null==e?null:e.showFooter)("title",null==e?null:e.title),r.\u0275\u0275advance(2),r.\u0275\u0275property("ngTemplateOutlet",u)}}function h(n,f){if(1&n){const e=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementStart(0,"pep-remote-loader",8),r.\u0275\u0275listener("hostEvents",function(p){r.\u0275\u0275restoreView(e);const g=r.\u0275\u0275nextContext(2);return r.\u0275\u0275resetView(g.onHostEvents(p))})("load",function(){r.\u0275\u0275restoreView(e);const p=r.\u0275\u0275nextContext(2);return r.\u0275\u0275resetView(p.onBlockLoad())}),r.\u0275\u0275elementEnd()}if(2&n){const e=r.\u0275\u0275nextContext(2);r.\u0275\u0275property("options",e.remotePathOptions)("hostObject",e.hostObject)}}const _=function(n){return{hostObject:n}},c=function(n){return{hostEvents:n}};function a(n,f){if(1&n){const e=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementStart(0,"pep-remote-loader-element",9),r.\u0275\u0275listener("load",function(){r.\u0275\u0275restoreView(e);const p=r.\u0275\u0275nextContext(2);return r.\u0275\u0275resetView(p.onBlockLoad())}),r.\u0275\u0275elementEnd()}if(2&n){const e=r.\u0275\u0275nextContext(2);r.\u0275\u0275property("options",e.remotePathOptions)("props",r.\u0275\u0275pureFunction1(3,_,e.hostObject))("events",r.\u0275\u0275pureFunction1(5,c,e.onHostEventsCallback))}}function m(n,f){if(1&n&&(r.\u0275\u0275template(0,h,1,2,"pep-remote-loader",6),r.\u0275\u0275template(1,a,1,7,"pep-remote-loader-element",7)),2&n){const e=r.\u0275\u0275nextContext();r.\u0275\u0275property("ngIf",e.remotePathOptions&&!e.loadElement),r.\u0275\u0275advance(1),r.\u0275\u0275property("ngIf",e.remotePathOptions&&e.loadElement)}}let b=(()=>{class n{constructor(e,u,p){this.httpService=e,this.sessionService=u,this.addonService=p}getBlockLoaderDataUrl(e){const u="addon_blocks",p=this.addonService.getPagesAddonUUID();let g;return g=e.pagesDevServer?.length>0?`${e.pagesDevServer}/${u}`:`${this.sessionService.getPapiBaseUrl()}/addons/api/${p}/${u}`,`${g}/get_addon_block_loader_data?name=${e.name}&slugName=${e.slugName}&blockType=${e.blockType}&addonUUID=${e.addonUUID}`}getRemoteLoaderOptions(e,u="",p="module"){const w={type:p,remoteEntry:u.length>0?u:`${e.addonPublicBaseURL}${e.relation.AddonRelativeURL}.js`,remoteName:e.relation.AddonRelativeURL,exposedModule:`./${e.relation.ElementsModule?.length>0?e.relation.ElementsModule:e.relation.ModuleName}`,addonId:e.relation.AddonUUID};return e.relation.ElementsModule?.length>0?w.elementName=e.relation.ElementName:w.componentName=e.relation.ComponentName,w}getBlockRemoteLoaderOptions(e){var u=this;return(0,E.Z)(function*(){return e.blockType=e.blockType??"AddonBlock",e.name=e.name??"",e.slugName=e.slugName??"",e.addonUUID=e.addonUUID??"",new Promise((p,g)=>{if(e.name?.length>0||e.slugName?.length>0&&"SettingsBlock"===e.blockType){const w=u.getBlockLoaderDataUrl(e);u.httpService.getHttpCall(w).toPromise().then(C=>{const ee=(0,x.coerceNumberProperty)(C.relation?.SubType?.toLocaleLowerCase().replace("ng",""),14)>=14?"module":"script";p(u.getRemoteLoaderOptions(C,e.blockRemoteEntry,ee))}).catch(C=>{g(`Block with ${"SettingsBlock"===e.blockType?`slugName - ${e.slugName}`:`name - ${e.name}`} is not found for type - ${e.blockType}`)})}else g("SettingsBlock"===e.blockType?"slugName is not supplied":"name is not supplied")})})()}}return n.\u0275fac=function(e){return new(e||n)(r.\u0275\u0275inject(S.PepHttpService),r.\u0275\u0275inject(S.PepSessionService),r.\u0275\u0275inject(S.PepAddonService))},n.\u0275prov=r.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),v=(()=>{class n{constructor(e,u){this.injector=e,this.pepAddonService=u,this._options=null,this._hostObject=null,this.hostEvents=new r.EventEmitter,this.load=new r.EventEmitter}set options(e){this._options=e,e&&this.loadModule()}get options(){return this._options}set hostObject(e){this._hostObject=e,this.setHostComponentIntoComponentRef()}get hostObject(){return this._hostObject}setHostComponentIntoComponentRef(){this.hostObject&&this.compRef?.instance&&(this.compRef.instance.hostObject=this.hostObject)}ngOnChanges(e){}loadModule(){var e=this;return(0,E.Z)(function*(){try{const u=performance.now();if(e.viewContainer?.clear(),e.options.exposedModule?.length>0){if(e.options?.addonId&&("module"===e.options.type||"script"===e.options.type)){const C=e.options.remoteEntry?.lastIndexOf("/")||-1;if(C>0){const W=e.options.remoteEntry.substring(0,C+1);e.pepAddonService.setAddonStaticFolder(W,e.options.addonId)}}const p=yield O(e.options).then(C=>C),g=(0,r.createNgModuleRef)(p[e.options.exposedModule.replace("./","")],e.injector);e.compRef=e.viewContainer.createComponent(p[e.options.componentName],{injector:e.injector,ngModuleRef:g});const w=performance.now();console.log("remote module load performance: "+(w-u)/1e3)}e.load.emit(),e.compRef&&(e.setHostComponentIntoComponentRef(),e.compRef?.instance.hostEvents?.subscribe(p=>{e.hostEvents.emit(p)}))}catch(u){console.error(u)}})()}ngOnDestroy(){this.compRef?.destroy(),this.viewContainer?.clear()}}return n.\u0275fac=function(e){return new(e||n)(r.\u0275\u0275directiveInject(r.Injector),r.\u0275\u0275directiveInject(S.PepAddonService))},n.\u0275cmp=r.\u0275\u0275defineComponent({type:n,selectors:[["pep-remote-loader"]],viewQuery:function(e,u){if(1&e&&r.\u0275\u0275viewQuery(Y,7,r.ViewContainerRef),2&e){let p;r.\u0275\u0275queryRefresh(p=r.\u0275\u0275loadQuery())&&(u.viewContainer=p.first)}},inputs:{options:"options",hostObject:"hostObject"},outputs:{hostEvents:"hostEvents",load:"load"},features:[r.\u0275\u0275NgOnChangesFeature],decls:2,vars:0,consts:[["placeHolder",""]],template:function(e,u){1&e&&r.\u0275\u0275template(0,t,0,0,"ng-template",null,0,r.\u0275\u0275templateRefExtractor)},encapsulation:2}),n})(),M=(()=>{class n{constructor(e,u,p,g,w){this.renderer=e,this.el=u,this.pepAddonService=p,this.remoteLoaderService=g,this.route=w,this.load=new r.EventEmitter,this.element=null,this._elementName=""}populateProps(){for(const e in this.props)this.element[e]=this.props[e]}setupEvents(){for(const e in this.events)this.element.addEventListener(e,this.events[e])}loadOptionsFromRoute(){var e=this;return(0,E.Z)(function*(){const u=e.route?.snapshot.params,p=e.route?.snapshot.data,g=p?.blockType||"SettingsBlock",w=u?.slugName||p?.slugName,C=u?.blockName||p?.blockName;if(C?.length>0||w?.length>0&&"SettingsBlock"===g){const W=u?.addonUUID||p?.addonUUID||"",ee=p?.blockRemoteEntry||"";e.options=yield e.remoteLoaderService.getBlockRemoteLoaderOptions({name:C,slugName:w,blockType:g,addonUUID:W,blockRemoteEntry:ee});const oe=`${e.options.remoteName}.js`;window.location.search.indexOf("dev=true")>0&&(e.options.remoteEntry=`http://localhost:4400/${oe}`),e.props=p}})()}ngOnChanges(){!this.element||this.populateProps()}ngOnDestroy(){}ngAfterContentInit(){var e=this;return(0,E.Z)(function*(){try{const u=performance.now();if(e.options||(yield e.loadOptionsFromRoute()),!e.options)throw new Error("No options supplied to the component.");{if(e.options?.addonId&&("module"===e.options.type||"script"===e.options.type)){const g=e.options.remoteEntry?.lastIndexOf("/")||-1;if(g>0){const w=e.options.remoteEntry.substring(0,g+1);e.pepAddonService.setAddonStaticFolder(w,e.options.addonId)}}yield O(e.options),e._elementName=e.options.elementName,e.element=e.renderer.createElement(e._elementName),e.populateProps(),e.setupEvents(),e.renderer.appendChild(e.el.nativeElement,e.element);const p=performance.now();console.log("remote module wc load performance: "+(p-u)/1e3),e.pepAddonService.connectInternalRouter(e._elementName),e.load.emit()}}catch(u){console.error(u)}})()}}return n.\u0275fac=function(e){return new(e||n)(r.\u0275\u0275directiveInject(r.Renderer2),r.\u0275\u0275directiveInject(r.ElementRef),r.\u0275\u0275directiveInject(S.PepAddonService),r.\u0275\u0275directiveInject(b),r.\u0275\u0275directiveInject(Q.ActivatedRoute,8))},n.\u0275cmp=r.\u0275\u0275defineComponent({type:n,selectors:[["pep-remote-loader-element"]],inputs:{options:"options",props:"props",events:"events"},outputs:{load:"load"},features:[r.\u0275\u0275NgOnChangesFeature],decls:0,vars:0,template:function(e,u){},styles:["[_nghost-%COMP%]{width:100%;height:inherit}[_nghost-%COMP%] >*{height:inherit}"]}),n})(),F=(()=>{class n{constructor(e){this.remoteLoaderService=e,this.addonId="",this.remoteEntry="",this.slugName="",this._blockType="AddonBlock",this._name="",this.hostObject=null,this._dialogRef=null,this.hostEvents=new r.EventEmitter,this.blockLoad=new r.EventEmitter,this.inDialog=!1,this.remotePathOptions=null,this.loadElement=!1,this.onHostEventsCallback=u=>{this.onHostEvents(u.detail)}}set blockType(e){this._blockType=e}get blockType(){return this._blockType}set name(e){this._name=e}get name(){return this._name}set dialogRef(e){this._dialogRef=e,this.inDialog=null!=this._dialogRef}get dialogRef(){return this._dialogRef}ngOnInit(){this.remoteLoaderService.getBlockRemoteLoaderOptions({name:this.name,slugName:this.slugName,blockType:this.blockType,addonUUID:this.addonId,blockRemoteEntry:this.remoteEntry}).then(u=>{this.loadElement=u.elementName?.length>0,this.remotePathOptions=u})}ngOnDestroy(){this.dialogRef&&(this.dialogRef=null),this.remotePathOptions=null}onBlockLoad(){this.blockLoad.emit()}onHostEvents(e){this.hostEvents.emit(e)}closeDialog(e){this.dialogRef?.close(e)}}return n.\u0275fac=function(e){return new(e||n)(r.\u0275\u0275directiveInject(b))},n.\u0275cmp=r.\u0275\u0275defineComponent({type:n,selectors:[["pep-addon-block-loader"]],viewQuery:function(e,u){if(1&e&&r.\u0275\u0275viewQuery(o,7,r.TemplateRef),2&e){let p;r.\u0275\u0275queryRefresh(p=r.\u0275\u0275loadQuery())&&(u.dialogTemplate=p.first)}},inputs:{addonId:"addonId",remoteEntry:"remoteEntry",slugName:"slugName",blockType:"blockType",name:"name",hostObject:"hostObject",dialogRef:"dialogRef"},outputs:{hostEvents:"hostEvents",blockLoad:"blockLoad"},decls:5,vars:1,consts:[[4,"ngIf"],["dialogTemplate",""],["remoteLoaderTemplate",""],[4,"ngTemplateOutlet"],[3,"showClose","showHeader","showFooter","title","close"],["pep-dialog-content",""],[3,"options","hostObject","hostEvents","load",4,"ngIf"],[3,"options","props","events","load",4,"ngIf"],[3,"options","hostObject","hostEvents","load"],[3,"options","props","events","load"]],template:function(e,u){1&e&&(r.\u0275\u0275template(0,i,2,1,"ng-container",0),r.\u0275\u0275template(1,s,3,5,"ng-template",null,1,r.\u0275\u0275templateRefExtractor),r.\u0275\u0275template(3,m,2,2,"ng-template",null,2,r.\u0275\u0275templateRefExtractor)),2&e&&r.\u0275\u0275property("ngIf",!u.inDialog)},dependencies:[j.NgIf,j.NgTemplateOutlet,D.PepDialogComponent,v,M]}),n})(),q=(()=>{class n{constructor(e){this.dialogService=e}loadAddonBlockInternal(e){if(null!==e.container){const u=e.container.createComponent(F),p=u.instance;return p.name=e.name,p.slugName=e.slugName,p.blockType=e.blockType||"AddonBlock",p.addonId=e.addonUUID,p.remoteEntry=e.blockRemoteEntry,p.hostObject=e.hostObject,p.hostEvents.subscribe(g=>{e.hostEventsCallback&&e.hostEventsCallback(g)}),u}return null}loadAddonBlockInContainer(e){return this.loadAddonBlockInternal(e)}loadAddonBlockInDialog(e){const u=this.loadAddonBlockInternal(e);if(u){const p=u.instance,g=this.dialogService.getDialogConfig({disableClose:!1,panelClass:"remote-loader-dialog"},e.size||"full-screen"),w={...e.config,...g};return p.dialogRef=this.dialogService.openDialog(p.dialogTemplate,e.data||null,w),p.dialogRef.afterClosed().subscribe(()=>{u.hostView.detach(),u.hostView.destroy(),u.destroy()}),p.dialogRef}return null}}return n.\u0275fac=function(e){return new(e||n)(r.\u0275\u0275inject(D.PepDialogService))},n.\u0275prov=r.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),ne=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=r.\u0275\u0275defineNgModule({type:n}),n.\u0275inj=r.\u0275\u0275defineInjector({providers:[q,b],imports:[j.CommonModule,z.HttpClientModule,X._8,J.MatDialogModule,S.PepNgxLibModule,D.PepDialogModule]}),n})()}}]);